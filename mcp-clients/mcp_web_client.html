<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP Server Tester</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; background-color: #f8f9fa; }
        .container { background: #fff; padding: 20px; border-radius: 8px; margin: 10px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header { text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 8px; margin-bottom: 20px; }
        input, button, select { padding: 12px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        input[type="text"] { width: calc(100% - 30px); }
        #output { background: #f8f9fa; padding: 15px; border-radius: 4px; max-height: 500px; overflow-y: auto; font-family: 'Courier New', monospace; white-space: pre-wrap; border: 1px solid #ddd; }
        .tool-button { background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .tool-button:hover { background: #218838; }
        .custom-button { background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .custom-button:hover { background: #0056b3; }
        .quick-actions { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
        .status { padding: 10px; border-radius: 4px; margin: 10px 0; }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .auth-section { background: #e3f2fd; padding: 15px; border-radius: 4px; margin-bottom: 20px; }
        .output-toggle { margin-bottom: 15px; }
        .toggle-button { 
            background: #6c757d; color: white; border: none; border-radius: 4px; 
            padding: 8px 15px; margin: 0 5px; cursor: pointer; font-size: 12px; 
        }
        .toggle-button.active { background: #007bff; }
        .toggle-button:hover { opacity: 0.8; }
        .visual-output { 
            background: #fff; padding: 15px; border-radius: 4px; 
            max-height: 500px; overflow-y: auto; border: 1px solid #ddd; 
        }
        .product-table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        .product-table th, .product-table td { 
            border: 1px solid #ddd; padding: 8px; text-align: left; 
        }
        .product-table th { background-color: #f8f9fa; font-weight: bold; }
        .product-table tr:nth-child(even) { background-color: #f9f9f9; }
        .json-output { 
            background: #f8f9fa; padding: 15px; border-radius: 4px; 
            max-height: 500px; overflow-y: auto; font-family: 'Courier New', monospace; 
            white-space: pre-wrap; border: 1px solid #ddd; 
        }
        .error-message { color: #dc3545; font-weight: bold; }
        .success-message { color: #28a745; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõ†Ô∏è MCP Server Test Client</h1>
        <p>Interactive testing for your Ravi MCP Server</p>
    </div>

    <div class="container auth-section">
        <h3>üîê Authentication Setup</h3>
        <p><strong>Step 1:</strong> Get your Google Cloud access token:</p>
        <code>gcloud auth print-access-token</code>
        <br><br>
        <p><strong>Note:</strong> Your server now supports CORS, so you can test directly from this web page!</p>
        <label for="accessToken">Access Token:</label>
        <input type="password" id="accessToken" placeholder="Paste your access token here" style="width: 70%;">
        <button class="custom-button" onclick="testAuth()">Test Auth</button>
        <div id="authStatus"></div>
    </div>
    
    <div class="container">
        <h3>‚ö° Quick Actions</h3>
        <div class="quick-actions">
            <button class="tool-button" onclick="callTool('list_products')">üì¶ List Products</button>
            <button class="tool-button" onclick="callTool('health_check')">‚ù§Ô∏è Health Check</button>
            <button class="tool-button" onclick="callTool('welcome_message')">üëã Welcome Message</button>
            <button class="tool-button" onclick="listTools()">üîß Show Available Tools</button>
        </div>
    </div>

    <div class="container">
        <h3>üéØ Custom Tool Call</h3>
        <div style="display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 10px; align-items: center;">
            <select id="toolName">
                <option value="">Select a tool...</option>
                <option value="list_products">list_products</option>
                <option value="create_product">create_product</option>
                <option value="get_product">get_product</option>
                <option value="update_product">update_product</option>
                <option value="delete_product">delete_product</option>
                <option value="health_check">health_check</option>
                <option value="welcome_message">welcome_message</option>
            </select>
            <input type="text" id="toolArgs" placeholder='Arguments as JSON: {"name":"iPhone","category":"Electronics","price":999}'>
            <button class="custom-button" onclick="customToolCall()">Call Tool</button>
        </div>
        
        <div style="margin-top: 15px;">
            <h4>üí° Example Arguments:</h4>
            <ul style="font-size: 12px; color: #666;">
                <li><strong>create_product:</strong> {"name":"iPhone 15","category":"Electronics","price":999}</li>
                <li><strong>get_product:</strong> {"id":"product-id-here"}</li>
                <li><strong>update_product:</strong> {"id":"product-id-here","price":899}</li>
                <li><strong>delete_product:</strong> {"id":"product-id-here"}</li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h3>üìÑ Output</h3>
        <div class="output-toggle">
            <button class="toggle-button active" id="visualToggle" onclick="toggleOutput('visual')">üìä Visual</button>
            <button class="toggle-button" id="jsonToggle" onclick="toggleOutput('json')">üìã JSON</button>
            <button class="toggle-button" onclick="clearOutput()">üóëÔ∏è Clear</button>
        </div>
        
        <div id="visualOutput" class="visual-output">
            <div style="text-align: center; color: #666;">
                Ready to test your MCP server! 
                <br><br>
                üöÄ <strong>Getting Started:</strong><br>
                1. Get your access token: <code>gcloud auth print-access-token</code><br>
                2. Paste it in the authentication section above<br>
                3. Click "Test Auth" to verify connection<br>
                4. Try the quick actions or create custom tool calls<br><br>
                üìç <strong>Server URL:</strong> https://ravi-mcp-server-256110662801.europe-west3.run.app/mcp
            </div>
        </div>
        
        <div id="jsonOutput" class="json-output" style="display: none;">
Ready to test your MCP server! 

üöÄ Getting Started:
1. Get your access token: gcloud auth print-access-token
2. Paste it in the authentication section above
3. Click "Test Auth" to verify connection
4. Try the quick actions or create custom tool calls

üìç Server URL: https://ravi-mcp-server-256110662801.europe-west3.run.app/mcp
        </div>
    </div>

    <script>
        const SERVER_URL = 'https://ravi-mcp-server-256110662801.europe-west3.run.app/mcp';
        
        function getAccessToken() {
            return document.getElementById('accessToken').value.trim();
        }
        
        function updateStatus(message, isError = false) {
            const timestamp = new Date().toLocaleTimeString();
            const status = isError ? '‚ùå ERROR' : '‚úÖ SUCCESS';
            
            // Update JSON output
            const jsonOutput = document.getElementById('jsonOutput');
            jsonOutput.innerHTML = `[${timestamp}] ${status}: ${message}\n\n${jsonOutput.innerHTML}`;
            
            // Update Visual output
            updateVisualOutput(message, isError, timestamp);
        }
        
        function updateVisualOutput(message, isError, timestamp) {
            const visualOutput = document.getElementById('visualOutput');
            const statusClass = isError ? 'error-message' : 'success-message';
            
            try {
                // Try to parse as JSON for visual formatting
                const data = JSON.parse(message);
                
                if (data.result && data.result.tools) {
                    // Tools list response
                    visualOutput.innerHTML = formatToolsList(data.result.tools, timestamp) + visualOutput.innerHTML;
                } else if (data.result && data.result.content && data.result.content[0] && data.result.content[0].data) {
                    // Product data response
                    const productData = data.result.content[0].data;
                    if (Array.isArray(productData)) {
                        visualOutput.innerHTML = formatProductTable(productData, timestamp) + visualOutput.innerHTML;
                    } else {
                        visualOutput.innerHTML = formatSingleProduct(productData, timestamp) + visualOutput.innerHTML;
                    }
                } else if (data.result && data.result.content && data.result.content[0] && data.result.content[0].text) {
                    // Text response (health check, welcome message)
                    visualOutput.innerHTML = `<div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 4px;">
                        <small style="color: #666;">[${timestamp}]</small><br>
                        <span class="${statusClass}">üìù ${data.result.content[0].text}</span>
                    </div>` + visualOutput.innerHTML;
                } else if (data.result && data.result.serverInfo) {
                    // Initialize response
                    visualOutput.innerHTML = `<div style="border: 1px solid #28a745; padding: 10px; margin: 10px 0; border-radius: 4px; background: #d4edda;">
                        <small style="color: #666;">[${timestamp}]</small><br>
                        <span class="success-message">üöÄ Server Connected!</span><br>
                        <strong>Server:</strong> ${data.result.serverInfo.name} v${data.result.serverInfo.version}<br>
                        <strong>Protocol:</strong> ${data.result.protocolVersion}
                    </div>` + visualOutput.innerHTML;
                } else if (data.error) {
                    // Error response
                    visualOutput.innerHTML = `<div style="border: 1px solid #dc3545; padding: 10px; margin: 10px 0; border-radius: 4px; background: #f8d7da;">
                        <small style="color: #666;">[${timestamp}]</small><br>
                        <span class="error-message">‚ùå Error ${data.error.code}: ${data.error.message}</span>
                        ${data.error.data ? `<br><small>Details: ${data.error.data}</small>` : ''}
                    </div>` + visualOutput.innerHTML;
                } else {
                    // Generic JSON response
                    visualOutput.innerHTML = `<div style="border: 1px solid #6c757d; padding: 10px; margin: 10px 0; border-radius: 4px;">
                        <small style="color: #666;">[${timestamp}]</small><br>
                        <span class="${statusClass}">üìÑ Response received</span><br>
                        <pre style="font-size: 12px; margin: 5px 0;">${JSON.stringify(data, null, 2)}</pre>
                    </div>` + visualOutput.innerHTML;
                }
            } catch (e) {
                // Not JSON, display as text
                visualOutput.innerHTML = `<div style="border: 1px solid #6c757d; padding: 10px; margin: 10px 0; border-radius: 4px;">
                    <small style="color: #666;">[${timestamp}]</small><br>
                    <span class="${statusClass}">${message}</span>
                </div>` + visualOutput.innerHTML;
            }
        }
        
        function formatProductTable(products, timestamp) {
            if (!products || products.length === 0) {
                return `<div style="border: 1px solid #ffc107; padding: 10px; margin: 10px 0; border-radius: 4px; background: #fff3cd;">
                    <small style="color: #666;">[${timestamp}]</small><br>
                    <span style="color: #856404;">üì¶ No products found in store</span>
                </div>`;
            }
            
            let table = `<div style="border: 1px solid #28a745; padding: 10px; margin: 10px 0; border-radius: 4px; background: #d4edda;">
                <small style="color: #666;">[${timestamp}]</small><br>
                <span class="success-message">üì¶ Products in Store (${products.length} items)</span><br><br>
                <table class="product-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Price</th>
                            <th>Category</th>
                            <th>ID</th>
                        </tr>
                    </thead>
                    <tbody>`;
            
            products.forEach(product => {
                table += `<tr>
                    <td>${product.name || 'N/A'}</td>
                    <td>$${product.price || '0'}</td>
                    <td>${product.category || 'Uncategorized'}</td>
                    <td style="font-family: monospace; font-size: 11px;">${(product.id || '').substring(0, 8)}...</td>
                </tr>`;
            });
            
            table += `</tbody></table></div>`;
            return table;
        }
        
        function formatSingleProduct(product, timestamp) {
            return `<div style="border: 1px solid #28a745; padding: 10px; margin: 10px 0; border-radius: 4px; background: #d4edda;">
                <small style="color: #666;">[${timestamp}]</small><br>
                <span class="success-message">üì¶ Product Details</span><br><br>
                <table class="product-table" style="width: auto;">
                    <tr><td><strong>Name</strong></td><td>${product.name || 'N/A'}</td></tr>
                    <tr><td><strong>Price</strong></td><td>$${product.price || '0'}</td></tr>
                    <tr><td><strong>Category</strong></td><td>${product.category || 'Uncategorized'}</td></tr>
                    <tr><td><strong>ID</strong></td><td style="font-family: monospace;">${product.id || 'N/A'}</td></tr>
                    <tr><td><strong>Segment</strong></td><td>${product.segment || 'N/A'}</td></tr>
                </table>
            </div>`;
        }
        
        function formatToolsList(tools, timestamp) {
            let toolsHtml = `<div style="border: 1px solid #007bff; padding: 10px; margin: 10px 0; border-radius: 4px; background: #e3f2fd;">
                <small style="color: #666;">[${timestamp}]</small><br>
                <span class="success-message">üîß Available Tools (${tools.length} tools)</span><br><br>
                <table class="product-table">
                    <thead>
                        <tr>
                            <th>Tool Name</th>
                            <th>Description</th>
                            <th>Required Fields</th>
                        </tr>
                    </thead>
                    <tbody>`;
            
            tools.forEach(tool => {
                const required = tool.inputSchema && tool.inputSchema.required ? tool.inputSchema.required.join(', ') : 'None';
                toolsHtml += `<tr>
                    <td style="font-family: monospace; font-weight: bold;">${tool.name}</td>
                    <td>${tool.description}</td>
                    <td style="font-family: monospace; font-size: 11px;">${required}</td>
                </tr>`;
            });
            
            toolsHtml += `</tbody></table></div>`;
            return toolsHtml;
        }
        
        function toggleOutput(type) {
            const visualOutput = document.getElementById('visualOutput');
            const jsonOutput = document.getElementById('jsonOutput');
            const visualToggle = document.getElementById('visualToggle');
            const jsonToggle = document.getElementById('jsonToggle');
            
            if (type === 'visual') {
                visualOutput.style.display = 'block';
                jsonOutput.style.display = 'none';
                visualToggle.classList.add('active');
                jsonToggle.classList.remove('active');
            } else {
                visualOutput.style.display = 'none';
                jsonOutput.style.display = 'block';
                visualToggle.classList.remove('active');
                jsonToggle.classList.add('active');
            }
        }
        
        function clearOutput() {
            document.getElementById('visualOutput').innerHTML = `
                <div style="text-align: center; color: #666;">
                    Output cleared. Ready for new requests!
                </div>`;
            document.getElementById('jsonOutput').innerHTML = 'Output cleared. Ready for new requests!';
        }
        
        async function testAuth() {
            const token = getAccessToken();
            if (!token) {
                updateStatus('Please enter an access token first', true);
                return;
            }
            
            const authStatus = document.getElementById('authStatus');
            authStatus.innerHTML = '<div class="status">Testing authentication...</div>';
            
            try {
                const response = await fetch(SERVER_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        jsonrpc: "2.0",
                        id: 1,
                        method: "initialize",
                        params: {
                            protocolVersion: "2024-11-05",
                            capabilities: {},
                            clientInfo: { name: "web-client", version: "1.0.0" }
                        }
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    authStatus.innerHTML = '<div class="status success">‚úÖ Authentication successful! Server is reachable.</div>';
                    updateStatus(JSON.stringify(result, null, 2));
                } else {
                    authStatus.innerHTML = '<div class="status error">‚ùå Authentication failed. Check your token.</div>';
                    updateStatus(`Authentication failed: ${response.status} ${response.statusText}`, true);
                }
            } catch (error) {
                authStatus.innerHTML = '<div class="status error">‚ùå Connection failed. Check server status.</div>';
                updateStatus(`Connection error: ${error.message}`, true);
            }
        }
        
        async function callMCP(method, params = {}) {
            const token = getAccessToken();
            if (!token) {
                updateStatus('Please enter an access token first', true);
                return;
            }
            
            const output = document.getElementById('output');
            updateStatus(`Calling ${method}...`);
            
            try {
                const request = {
                    jsonrpc: "2.0",
                    id: Date.now(),
                    method: method,
                    params: params
                };
                
                const response = await fetch(SERVER_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(request)
                });
                
                const result = await response.json();
                
                if (result.error) {
                    updateStatus(`${method} failed: ${JSON.stringify(result.error, null, 2)}`, true);
                } else {
                    updateStatus(JSON.stringify(result.result, null, 2));
                }
                
            } catch (error) {
                updateStatus(`${method} error: ${error.message}`, true);
            }
        }
        
        function callTool(toolName) {
            callMCP('tools/call', {
                name: toolName,
                arguments: {}
            });
        }
        
        function listTools() {
            callMCP('tools/list');
        }
        
        function customToolCall() {
            const toolName = document.getElementById('toolName').value;
            const argsText = document.getElementById('toolArgs').value;
            
            if (!toolName) {
                updateStatus('Please select a tool first', true);
                return;
            }
            
            let args = {};
            if (argsText) {
                try {
                    args = JSON.parse(argsText);
                } catch (e) {
                    updateStatus('Invalid JSON in arguments', true);
                    return;
                }
            }
            
            callMCP('tools/call', {
                name: toolName,
                arguments: args
            });
        }
        
        // Auto-focus on token input
        document.getElementById('accessToken').focus();
    </script>
</body>
</html>
